<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Mathew Kurian">
    <title>KiWi API</title>
    <link rel="stylesheet" href="/css/rest.styles.css">
    <script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>
    <script src="http://code.jquery.com/jquery-2.0.0.min.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="wrapper">
    <header>
        <a href="https://github.com/getKiWi/KiWi.MainFrame"><h1>KiWi API</h1></a>

        <p>Web portal for all IO for all KiWi products </p>

        <p class="view"><a href="https://github.com/getKiWi/KiWi.MainFrame">View the Project on GitHub
                <small>bluejamesbond/ExcelQuery</small>
            </a></p>
        <ul>
            <li><a href="https://github.com/getKiWi/KiWi.MainFrame/zipball/master">Download <strong>ZIP File</strong></a>
            </li>
            <li><a href="https://github.com/getKiWi/KiWi.MainFrame/raw/master/Lib/ExcelQueryInstallerUpdater.xlam">Download
                    <strong>Installer</strong></a></li>
            <li><a href="https://github.com/getKiWi/KiWi.MainFrame">View On <strong>GitHub</strong></a></li>
        </ul>
        <h4>Topics</h4>

        <div class="posts">

            <a href="#">Socket Test</a></br>

        </div>
    </header>
    <section>
        <div class="page">
            <div class="content">
                <h2>Socket Test</h2>

                <p>Learn how to create a whiteboard that users can draw on simultaneously.</p>

                <style>
                    a {
                        cursor: pointer;
                    }
                </style>
                <p>
                    <a id="open">Open</a> starts a websocket connection attached to your token<br>
                    <a id="close">Close</a> ends all connection linked to token - even across multiple browsers<br>
                    <a id="emit">Emit</a> the <input placeholder="text here" type="text" id="content" name="content"
                                                     style="border:none;border-bottom:1px solid #888;padding:0;margin:0;outline:none;"><br><br>
                    <b>Note:</b> It is recommended you open another browser to see how this works.

                </p>

                <div id="res"></div>
    </section>
    <footer>
        <p>This project is maintained by <a href="https://github.com/bluejamesbond">bluejamesbond</a></p>

        <p>
            <small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a>
            </small>
        </p>
    </footer>
</div>
<script>

    $("#open").click(function (e) {
        e.preventDefault();
        $.get("/rest/socket/open?token=<%= token %>&client_id=<%= client_id %>", function (data) {
            var socket = _socket = io(window.location.origin, {
                query: data.data.query + "&action=account",
                forceNew: true
            });
            socket.on('*', function (msg) {
                appendTextArea("WebSocket", msg);
            });
        });
    });

    $("#emit").click(function (e) {
        e.preventDefault();
        $.get("/rest/socket/debug/emit?token=<%= token %>&client_id=<%= client_id %>&content=" + $("#content").val(), function () {
        });
    });

    $("#close").click(function (e) {
        e.preventDefault();
        $.get("/rest/socket/close?token=<%= token %>&client_id=<%= client_id %>", function (data) {
            appendTextArea("Http-Get", data);
        });
    });


    var appendTextArea = function (title, msg) {
        $("#res").prepend("<h3>"+title+"</h3><pre><code style='white-space: pre'>" + JSON.stringify(msg, null, 4) + "</code></<pre>");
    }

</script>
</body>
</html>
